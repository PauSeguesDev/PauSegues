---
// Header.astro
interface Props {
    linksTexts: string[]
    linksHref: string[]
}

const { linksTexts, linksHref } = Astro.props;
---

<header class="bg-web-dark-blue">
    <div class="px-4 sm:px-10 md:px-24 lg:px-36 py-4">
        <nav>
            <div class="flex justify-between items-center">
                <!-- Brand -->
                <div>
                    <a href={linksHref[0]} class="text-2xl font-bold">
                        <img src="images/logo.webp" alt="" class="w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 hover:scale-110">
                    </a>
                </div>

                <!-- Menú desktop -->
                <div class="hidden md:flex items-center space-x-6">
                    <ul class="flex flex-row space-x-4 [&>li]:hover:scale-110">
                        {
                            linksTexts.map((text, i) => (
                                <li><a href={linksHref[i]}>{text}</a></li>
                            ))
                        }
                    </ul>

                    <!-- Select de idioma -->
                    <select id="language-select" class="bg-web-dark-blue text-white border border-white rounded p-1 cursor-pointer">
                        <option value="/">CAT</option>
                        <option value="/es/">ES</option>
                        <option value="/en/">EN</option>
                    </select>
                </div>

                <!-- Mobile Button -->
                <div class="md:hidden">
                    <button id="menu-btn" class="flex flex-col justify-between w-6 h-6 p-1 rounded hover:bg-web-pearl-blue cursor-pointer">
                        <span class="block h-0.5 w-full bg-white transition-transform duration-300 origin-center"></span>
                        <span class="block h-0.5 w-full bg-white transition-opacity duration-300"></span>
                        <span class="block h-0.5 w-full bg-white transition-transform duration-300 origin-center"></span>
                    </button>
                </div>
            </div>

            <!-- Menú móvil -->
            <div id="mobile-menu" class="hidden md:hidden mt-2">
                <ul class="flex flex-col space-y-2 [&>li]:hover:scale-110">
                        {
                            linksTexts.map((text, i) => (
                                <li><a href={linksHref[i]}>text</a></li>
                            ))
                        }
                    <li>
                        <select id="mobile-language-select" class="bg-web-dark-blue text-white border border-white rounded p-1 w-full cursor-pointer">
                            <option value="/">CAT</option>
                            <option value="/es/">ES</option>
                            <option value="/en/">EN</option>
                        </select>
                    </li>
                </ul>
            </div>
        </nav>
    </div>
</header>

<script type="module">
    const btn = document.getElementById('menu-btn');
    const menu = document.getElementById('mobile-menu');

    if(btn && menu){
        const spans = btn.querySelectorAll('span');
        btn.addEventListener('click', () => {
            menu.classList.toggle('hidden');
            spans[0].classList.toggle('rotate-45');
            spans[0].classList.toggle('translate-y-1.5');
            spans[1].classList.toggle('opacity-0');
            spans[1].classList.toggle('scale-x-0');
            spans[2].classList.toggle('-rotate-45');
            spans[2].classList.toggle('-translate-y-1.5');
        });
    }

    // Función de idioma
    function setupLanguageSelect(selectId) {
        const select = document.getElementById(selectId);
        if (!select) return;

        // Detectem l'idioma actual segons la URL
        const path = window.location.pathname;
        let currentLang = '/';
        if (path.startsWith('/es/')) currentLang = '/es/';
        else if (path.startsWith('/en/')) currentLang = '/en/';
        select.value = currentLang;

        select.addEventListener('change', () => {
            const newLang = select.value;
            // Substituïm el prefix si ja existeix
            let newPath = path;
            if (currentLang !== '/') {
                newPath = path.replace(currentLang, newLang);
            } else {
                newPath = newLang + path.slice(1); // afegim el nou prefix
            }
            window.location.href = newPath;
        });
    }

    setupLanguageSelect('language-select');
    setupLanguageSelect('mobile-language-select');
</script>
